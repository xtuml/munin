# Cheatsheet

## Prerequisites

- Docker and docker compose
- python 3
- BridgePoint
- [jq](https://jqlang.github.io/jq/)

## Populate Conan Server

Before building, it is required to populate a local cache with the MASL
artifacts. This step is only required once before building.

From the root of the repository, execute the following command:

```
./bin/populate.sh
```

This may take some time as it downloads ~500MB of data.

## Build Projects

### Generate MASL

To generate MASL, import the project(s) you desire to build into a BridgePoint
workspace and export MASL by clicking the hammer icon or selecting "Build
Project" from the context menu.

You can generate MASL for all projects by navigating to the `models/` directory
and executing the following command:

```
./gen_all.sh
```

If `<BP install>/tools/mc/bin` is in your `PATH`, the `xtuml2masl` script will
be executed. If not, a docker container will be used to generate the MASL.

### Build All

To build all projects, including the deployment, navigate to the `models/`
directory and execute:

```
./build_all.sh
```

All build artifacts including C++ source code can be found in the `build/`
directory in each project.

### Incremental Builds

To build a single project, navigate to the project directory and execute the
command:

```
../../bin/build.sh
```

If the project had been built previously, this command will perform an
incremental build and should not have to recompile all the sources. It is
recommended that a full build be performed first and then incremental builds
during development. Note that the build command does not cause MASL to be
re-exported. That must be done manually as a separate step.

NOTE: The deployment must be rebuilt if any domain is changed in order for
changes in the domain to manifest in the application. It is recommended to
always run `./build_all.sh` after making changes in a domain but before running
the integrated application.

### Cleaning

Artifacts generated by the build can be removed by navigating to the project
directory and executing the command:

```
../../bin/clean.sh
```

All projects can be cleaned by navigating to the `models/` directory and executing
the command:

```
./clean_all.sh
```

## Running

### Launching The Application

Once the entire system has successfully built, the application can be launched
by navigating to the `deploy/` directory and executing the following command:

```
docker compose up
```

### Running Regression Tests

The regression suite can be run by navigating to the `tests/` directory and
executing the following command:

```
./regression.sh
```

## Testing

To build a project with tests enabled, navigate to the project directory and
execute the command:

```
../../bin/build.sh test
```

Once the build is complete, run the tests by executing the command:

```
../../bin/test.sh
```

A success or failure message is printed at the end of the test run.


